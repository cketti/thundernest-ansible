machine:
  python:
    version: 2.7.9
dependencies:
  pre:
    - sudo apt-get install python-pip python-dev git curl
    # Install Ansible.
    - pip install ansible==2.2.1.0
    - pip install -r requirements.txt
    - ansible-galaxy install --ignore-errors geerlingguy.apache
    - git clone https://github.com/AGWA/git-crypt.git
    - cd git-crypt; sudo make install; cd ..
    - base64 -d $GIT_CRYPT_KEY > thundernest-ansible.key
    - git-crypt unlock thundernest-ansible.key
  post:

test:
  override:
    - ansible-playbook --syntax-check --extra-vars="server_hostname=web3 linode_plan=1" provision-server.yml
    - ansible-playbook --syntax-check -i "web3.thunderbird.net,web4.thunderbird.net" --extra-vars var_hosts=all setup-webheads.yml
    - python build_servers.py test
    - python lino.py forcedelete webtest1 webtest2

