apache_remove_default_vhost: true
apache_vhosts_filename: "ssl.conf"
apache_global_vhost_settings: |
      LoadModule ssl_module modules/mod_ssl.so
      Listen 443
      SSLPassPhraseDialog  builtin
      SSLSessionCache         shmcb:/var/cache/mod_ssl/scache(512000)
      SSLSessionCacheTimeout  300
      Mutex default
      SSLRandomSeed startup file:/dev/urandom  256
      SSLRandomSeed connect builtin
      SSLCryptoDevice builtin
apache_vhosts_template: "vars/vhost_template.j2"
apache_certificate_key_file: "/etc/httpd/conf/privkey.pem"
apache_certificate_file: "/etc/httpd/conf/cert.pem"
apache_certificate_chain_file: "/etc/httpd/conf/chain.pem"
non_ssl_parameters: |
      ExpiresActive On
      ExpiresDefault "access plus 6 hours"
      RewriteEngine On
      RewriteCond %{HTTPS} off
      RewriteRule ^.*$ https://%{SERVER_NAME}%{REQUEST_URI} [L,R=301,NE]

apache_vhosts:
  - servername: "live.thunderbird.net"
    serveralias: "live.mozillamessaging.com live-stage.thunderbird.net"
    documentroot: "/var/www/html/live.momo/htaccess/"
    extra_parameters: |
      ExpiresActive On
      ExpiresDefault "access plus 6 hours"

  - servername: "autoconfig.thunderbird.net"
    serveralias: "autoconfig-live.mozillamessaging.com autoconfig-stage.thunderbird.net"
    documentroot: "/var/www/html/autoconfig.momo/"
    options: "+Indexes +FollowSymLinks"
    extra_parameters: |
      ForceType text/xml
      ExpiresActive On
      ExpiresDefault "access plus 1 hour"
      RewriteEngine On
      RewriteRule ^/autoconfig/(.*)$ /$1 [L,R=301,NE]
      ErrorLog "|/usr/sbin/rotatelogs /var/log/httpd/autoconfig/error_log_%Y-%m-%d 604800 -480"
      CustomLog "|/usr/sbin/rotatelogs /var/log/httpd/autoconfig/access_%Y-%m-%d 604800 -480" combined

  - servername: "broker.thunderbird.net"
    serveralias: "broker-live.mozillamessaging.com broker-stage.thunderbird.net"
    documentroot: "/var/www/services/broker"
    extra_parameters: |
      WSGIDaemonProcess broker.thunderbird.net processes=2 threads=15 display-name=%{GROUP} python-home=/var/www/tbservices
      WSGIProcessGroup broker.thunderbird.net
      WSGIScriptAlias /provider /var/www/services/broker/broker.wsgi

  - servername: "mx.thunderbird.net"
    serveralias: "mx-live.mozillamessaging.com mx-stage.thunderbird.net"
    documentroot: "/var/www/services/mx"
    extra_parameters: |
      WSGIDaemonProcess mx.thunderbird.net processes=2 threads=15 display-name=%{GROUP} python-home=/var/www/tbservices
      WSGIProcessGroup mx.thunderbird.net
      WSGIScriptAlias /dns/mx /var/www/services/mx/wsgi.py

  - servername: "support.thunderbird.net"
    serveralias: "support.mozillamessaging.com support-stage.thunderbird.net"
    extra_parameters: |
      RewriteEngine On
      RewriteCond %{HTTP:X-Forwarded-Proto} ^http$
      RewriteRule ^.*$ https://%{SERVER_NAME}%{REQUEST_URI} [L,R=301,NE]
      RewriteCond %{REQUEST_URI} ^/kb/ask$
      RewriteRule (.*) https://support.mozilla.org/en-US/questions/new/thunderbird [L]
      RewriteCond %{REQUEST_URI} ^/([^/]+)/kb/ask$
      RewriteRule (.*) https://support.mozilla.org/%1/questions/new/thunderbird [L]
      RewriteCond %{REQUEST_URI} ^/([^/]+)/kb/category/20$
      RewriteRule (.*) https://support.mozilla.org/%1/products/thunderbird/how [L]
      RewriteCond %{REQUEST_URI} ^/kb/category/20$
      RewriteRule (.*) https://support.mozilla.org/products/thunderbird/how [L]
      RewriteCond %{REQUEST_URI} ^/kb/filelink-large-attachments$
      RewriteRule (.*) https://support.mozilla.org/kb/filelink-large-attachments [L]
      RewriteCond %{REQUEST_URI} ^/[^/]+/kb/.*
      RewriteRule (.*) https://support.mozilla.org$1 [L]
      RewriteCond %{REQUEST_URI} ^/kb/(.*)
      RewriteRule (.*) https://support.mozilla.org/kb/%1 [L]
      RewriteCond %{REQUEST_URI} ^/([^/]+)/home
      RewriteRule (.*) https://support.mozilla.org/%1/products/thunderbird [L]
      RewriteCond %{REQUEST_URI} ^/$
      RewriteRule (.*) https://support.mozilla.org/products/thunderbird [L]

  - servername: "support.live.mozillamessaging.com"
    serveralias: "support-stage.live.thunderbird.net"
    extra_parameters: |
      ExpiresActive On
      ExpiresDefault "now plus 6 hours"
      <Location />
        RewriteEngine On
        RewriteRule .* http://support.mozillamessaging.com/ [R=302]
      </Location>

  - servername: "www.thunderbird.net"
    serveralias: "mozillamessaging.com www.mozillamessaging.com thunderbird.net www-stage.thunderbird.net stage.thunderbird.net getthunderbird.com www.getthunderbird.com"
    extra_parameters: |
      ExpiresActive On
      ExpiresDefault "now plus 6 hours"
      <Location />
        RewriteEngine On
        RewriteRule .* https://www.mozilla.org/thunderbird [R=302]
      </Location>

  - servername: "start.thunderbird.net"
    serveralias: "start-stage.thunderbird.net"
    documentroot: "/var/www/html/start/site"
    extra_parameters: |
      ExpiresActive On
      ExpiresDefault "access plus 8 hours"

  - servername: "mail.thunderbird.net"
    extra_parameters: |
      ExpiresActive On
      ExpiresDefault "now plus 24 hours"
      <Location />
        RewriteEngine On
        RewriteRule .* https://www.fastmail.com/login/?domain=thunderbird.net [R=302]
      </Location>
