apache_global_vhost_settings: |
  DirectoryIndex index.php index.html
  Alias /.well-known/acme-challenge /var/www/dehydrated

  <Directory /var/www/dehydrated>
          Options None
          AllowOverride None

          # Apache 2.4
          <IfModule mod_authz_core.c>
                  Require all granted
          </IfModule>
  </Directory>

apache_remove_default_vhost: true
apache_vhosts:
  - servername: "live.thunderbird.net"
    serveralias: "live.mozillamessaging.com live-stage.thunderbird.net"
    documentroot: "/var/www/html/live.momo/htaccess/"
    extra_parameters: |
      RewriteEngine On
      RewriteCond %{HTTP:X-Forwarded-Proto} ^http$
      RewriteRule ^.*$ https://%{SERVER_NAME}%{REQUEST_URI} [L,R=301,NE]

  - servername: "autoconfig.thunderbird.net"
    serveralias: "autoconfig-live.mozillamessaging.com autoconfig-stage.thunderbird.net"
    documentroot: "/var/www/html/autoconfig.momo/"
    options: "+Indexes +FollowSymLinks"
    extra_parameters: |
      ForceType text/xml
      ExpiresActive On
      ExpiresDefault "access plus 1 hour"
      RewriteEngine On
      RewriteCond %{HTTP:X-Forwarded-Proto} ^http$
      RewriteRule ^.*$ https://%{SERVER_NAME}%{REQUEST_URI} [L,R=301,NE]

  - servername: "broker.thunderbird.net"
    serveralias: "broker-live.mozillamessaging.com broker-stage.thunderbird.net"
    documentroot: "/var/www/services/broker"
    extra_parameters: |
      WSGIDaemonProcess broker.thunderbird.net processes=2 threads=15 display-name=%{GROUP} python-home=/var/www/tbservices
      WSGIProcessGroup broker.thunderbird.net
      WSGIScriptAlias /provider /var/www/services/broker/broker.wsgi
      RewriteEngine On
      RewriteCond %{HTTP:X-Forwarded-Proto} ^http$
      RewriteRule ^.*$ https://%{SERVER_NAME}%{REQUEST_URI} [L,R=301,NE]

  - servername: "mx.thunderbird.net"
    serveralias: "mx-live.mozillamessaging.com mx-stage.thunderbird.net"
    documentroot: "/var/www/services/mx"
    extra_parameters: |
      WSGIDaemonProcess mx.thunderbird.net processes=2 threads=15 display-name=%{GROUP} python-home=/var/www/tbservices
      WSGIProcessGroup mx.thunderbird.net
      WSGIScriptAlias /dns/mx /var/www/services/mx/wsgi.py
      RewriteEngine On
      RewriteCond %{HTTP:X-Forwarded-Proto} ^http$
      RewriteRule ^.*$ https://%{SERVER_NAME}%{REQUEST_URI} [L,R=301,NE]

  - servername: "support.thunderbird.net"
    serveralias: "support.mozillamessaging.com support-stage.thunderbird.net"
    extra_parameters: |
      RewriteEngine On
      RewriteCond %{HTTP:X-Forwarded-Proto} ^http$
      RewriteRule ^.*$ https://%{SERVER_NAME}%{REQUEST_URI} [L,R=301,NE]
      RewriteCond %{REQUEST_URI} ^/kb/ask$
      RewriteRule (.*) https://support.mozilla.org/en-US/questions/new/thunderbird [L]
      RewriteCond %{REQUEST_URI} ^/([^/]+)/kb/ask$
      RewriteRule (.*) https://support.mozilla.org/%1/questions/new/thunderbird [L]
      RewriteCond %{REQUEST_URI} ^/([^/]+)/kb/category/20$
      RewriteRule (.*) https://support.mozilla.org/%1/products/thunderbird/how [L]
      RewriteCond %{REQUEST_URI} ^/kb/category/20$
      RewriteRule (.*) https://support.mozilla.org/products/thunderbird/how [L]
      RewriteCond %{REQUEST_URI} ^/kb/filelink-large-attachments$
      RewriteRule (.*) https://support.mozilla.org/kb/filelink-large-attachments [L]
      RewriteCond %{REQUEST_URI} ^/[^/]+/kb/.*
      RewriteRule (.*) https://support.mozilla.org$1 [L]
      RewriteCond %{REQUEST_URI} ^/kb/(.*)
      RewriteRule (.*) https://support.mozilla.org/kb/%1 [L]
      RewriteCond %{REQUEST_URI} ^/([^/]+)/home
      RewriteRule (.*) https://support.mozilla.org/%1/products/thunderbird [L]
      RewriteCond %{REQUEST_URI} ^/$
      RewriteRule (.*) https://support.mozilla.org/products/thunderbird [L]

  - servername: "support.live.mozillamessaging.com"
    serveralias: "support-stage.live.thunderbird.net"
    extra_parameters: |
      ExpiresActive On
      ExpiresDefault "now plus 6 hours"
      <Location />
        RewriteEngine On
        RewriteRule .* http://support.mozillamessaging.com/ [R=302]
      </Location>
